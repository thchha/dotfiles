#!/usr/bin/env lua

package.path = ";/home/tomes/workspace/lua/zeiterfassung/?.lua"

local zeiterf_db = require 'zeiterfassung_db'
local res, proj, act, task = zeiterf_db.getLatest()
if not res then
	res = "check the database of zeiterfassung. Error: " .. proj
else
	if act == "login" then
		res = string.format("Logged into project\n\"%s\"\n\nsince %d seconds",
		proj, os.time() - res)
	elseif act == "logout" then
		res = string.format("CURRENTLY NOT LOGGED IN.")
	else
		res = string.format("DUMP UNKNOWN STATE:\n%s, %s, %s, %s",
		res, proj, act, task)
	end
end
zeiterf_db.db:close()
io.popen(string.format("notify-send -u low -t 20000 \"%s\"", res), "r")
