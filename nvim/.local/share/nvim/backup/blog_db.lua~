--[[
CREATE TABLE `posts` (
	`id`	INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT UNIQUE,
	`created`	INTEGER NOT NULL,
	`updated`	INTEGER NOT NULL,
	`title`	TEXT NOT NULL UNIQUE,
	`abstract`	TEXT NOT NULL,
	`content`	TEXT NOT NULL,
  `count` INTEGER NOT NULL,
);
--
]]

local sqlite = require 'lsqlite'

local M = { }
local path = "/mnt/db/blog.sqlite3"

local db = sqlite.open(path)
if not db then
  print("no db handle")
  os.exit(-1)
end

function M.getAll()
  local query = [[
SELECT * FROM posts ORDER BY created DESC;
  ]]
  return db:exec(query)
end

function M.getById(id)
  local update = "UPDATE posts SET count = count +1 WHERE id = %d;"
  local query = [[
SELECT * FROM posts WHERE id = %d;
  ]]
  db:exec(string.format(update, id))
  return db:exec(string.format(query, id))
end

return M
